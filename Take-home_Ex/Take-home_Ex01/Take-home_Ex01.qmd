---
title: "Take-home Exercise 01: Visualizing and Uncovering Trends on Heart Attacks in Japan"
format: html
author: "Sei Sar Hla Kyi"
date: "`r Sys.Date()`"
date-modified: "`r Sys.Date()`"
execute: 
  eval: true
  echo: true
  message: false
  freeze: true
  warning: false
---

# 1 Overview

## 1.1 Background

Heart disease remains one of the leading causes of mortality worldwide, and Japan is no exception. Despite the country's reputation for longevity and a traditionally healthy diet, heart-related health issues—including heart attacks—continue to be a significant public health concern. The impact of heart attacks varies across different age groups, with risk factors and outcomes often differing between younger and older individuals. While Japan’s aging population naturally sees a higher prevalence of heart attacks among adults, recent trends suggest that younger individuals are also increasingly at risk, raising concerns about lifestyle habits and diet.

Historically, Japan’s diet—rich in fish, vegetables, and low in saturated fats—has been associated with lower cardiovascular disease rates. However, research by Iso (2011) has highlighted a gradual shift toward Westernized dietary patterns, characterized by increased consumption of meat and processed foods, which has contributed to rising cholesterol levels and a greater risk of heart disease. Additionally, lifestyle factors such as physical inactivity, smoking, and alcohol consumption have played a role in shaping cardiovascular health trends within the country.

Medical advancements and early interventions have improved survival rates, but the rising burden of cardiovascular diseases still calls for further research and public awareness.

## 1.2 Objectives

This article aims to explore the patterns of heart attacks in Japan across different age groups and shedding light on key factors contributing to their occurrence. By examining trends, potential risk factors, and demographic variations, we seek to provide insights into how heart attack cases differ between youth and adults.

Through data-driven visualizations, we will highlight the prevalence, underlying causes, and potential warning signs associated with heart attacks in Japan. The goal is to help healthcare professionals, policymakers, and the general public better understand the evolving landscape of cardiovascular health and to encourage proactive measures for prevention and early detection.

------------------------------------------------------------------------

# 2 Methodology & R Packages Used

We will follow the outlined methodology flow for this exercise, starting with data import, followed by data preparation, and concluding with insights from statistical graphics and multiple logistic regression.

![](Methodology.png)

The following R packages will be used to achieve the objective.

::: panel-tabset
## Packages Used

| Package | Explanation |
|------------------------------------|------------------------------------|
| tidyverse | to efficiently manipulate and clean data, utilizing functions from packages like `dplyr` and `tidyr` for data wrangling. |
| ggplot2 | to create informative and aesthetically pleasing visualizations, such as histograms and boxplots, to analyze the data |
| patchwork | to combine multiple ggplot2 plots into a cohesive layout, making it easier to present related visualizations side by side |
| ggdist | for visualizing distributions and uncertainty in data, particularly helpful for displaying probability distributions, densities, and interval estimates in an intuitive way. |
| ggridges | for visualizing the distribution of a numerical variable across different categories in a compact and aesthetically appealing manner. |
| ggstatsplot | to enhance ggplot2 by incorporating statistical tests directly into visualizations, providing plots with annotations for effect sizes, p-values, confidence intervals, and other relevant statistical metrics. |
| ggthemes | for additional themes and color palettes for ggplot2, allowing for more customization and better aesthetics |
| scales | to rescale continuous variables for logistic regression |
| gtsummary | to customize summarization of model outputs |

## Code to Install and Launch

```{r}
pacman::p_load(tidyverse,patchwork, ggdist, ggridges,ggstatsplot,ggthemes,scales,gtsummary)
```
:::

------------------------------------------------------------------------

# 3 The Dataset

The dataset, *Heart Attack in Japan: Youth vs. Adult,* used in this analysis was obtained from Kaggle. It contains data for heart attack cases across different age groups.

This dataset includes both numerical and categorical variables related to cardiovascular health, such as cholesterol levels, blood pressure, heart rate, and lifestyle factors. These indicators are crucial in assessing the likelihood of heart attacks and understanding how risk factors differ between younger and older populations.

In the next section, we will import the raw dataset and refine it further to ensure its readiness for visual analysis and gain deeper insights.

------------------------------------------------------------------------

# 4 Data Preparation

## 4.1 Importing the Data

The code chunk below imports *japan_heart_attack_dataset.csv* into R environment by using *read_csv()* function of **readr** package. **readr** is one of the tidyverse package.

```{r}
heartattack_data <- read_csv("data/raw/japan_heart_attack_dataset.csv")
```

Let's view the structure of the dataset using *glimpse()*, which allows us to see data structure and variable names as well as types.

```{r}
glimpse(heartattack_data)
```

At a glimpse, we see that there at 32,000 rows and 32 columns.

## 4.2 Filtering for Relevant Variables

We notice that there were certain columns titled "Extra_Column\_" from column number 18 to 32. We will remove these columns as there are no explanations in the metadata from the source, leaving us with 17 variables to work with.

```{r}
heartattack_data <- heartattack_data %>% select(-c(18:32))
```

We also notice that this dataset also contains data for people with no heart attack occurrence (in the Heart_Attack_Occurrence column). Since we are performing exploratory data analysis (EDA), it would be valuable to keep both groups, as this allows us to identify and compare characteristics like age, gender, lifestyle, or pre-existing conditions between those who had a heart attack and those who didn't, potentially letting us uncover patterns or trends that can inform the study.

## 4.3 Checking for Duplicates and Missing values

It is essential to check for duplicates and missing values before we move forward. We will use the following code to check for them.

::: panel-tabset
## Checking for Duplicates

The *duplicated()* function in the **base** package is used to check for duplicates in heartattack_data.

```{r}
sum(duplicated(heartattack_data))
```

## Checking for Missing Values

The *colSums()* function in the **base** package is used to check for missing values in heartattack_data.

```{r}
colSums(is.na(heartattack_data))
```
:::

We have confirmed that there are no duplicates and missing values in this dataset.

## 4.4 Grouping Variables into Categories

Some numerical variables (represented as "dbl" when we checked data structure in section 4.1), will be grouped into the following categories for meaningful insights:

-   **Age:** For this variable which ranges from 18 to 79, we will use equal bins for each category, categorized as:

    -   **Young**: 18–39

    -   **Middle-Aged**: 40–59

    -   **Old**: 60–79

-   **Stress Level:** A common method to measure stress is the Perceived Stress Scale (Cohen,1994) where individuals rate their stress from 0 (no stress) to 10 (extreme stress). Since our dataset uses a 0 to 10 range, it's likely a self-reported scale, where 0-3 represents minimal or manageable stress, 4-6 represents moderate stress and 7-10 represents high to extreme stress, with potential health risks. Therefore, we will categorize the stress levels as:

    -   **Low:** 0.000–3.999
    -   **Medium:** 4.000–6.999
    -   **High:** 7.000–10.000

```{r}
heartattack_data <- heartattack_data %>%
  mutate(
    AgeCat = case_when(
      Age >= 18 & Age <= 39 ~ "Young",
      Age >= 40 & Age <= 59 ~ "Middle-Aged",
      Age >= 60 & Age <= 79 ~ "Old"
    ),
    
    
    Stress = case_when(
      Stress_Levels >= 0.000 & Stress_Levels <= 3.999999 ~ "Low",
      Stress_Levels > 4.000 & Stress_Levels <= 6.999999 ~ "Medium",
      Stress_Levels > 7.000 & Stress_Levels <= 10.000 ~ "High"
    )
  )

```

## 4.5 Convert Data Types

We note that all variables are in the correct data types. However, we will convert the categorical columns such as Smoking_History, Diabetes_History, Hypertension_History, Family_History Heart_Attack_Occurrence, and our newly created columns as factor for better visualisation and to put the categories in order.

```{r}
heartattack_data <- heartattack_data %>%
  mutate(
    Smoking_History = factor(Smoking_History, levels = c("No", "Yes")),
    Diabetes_History = factor(Diabetes_History, levels = c("No", "Yes")),
    Hypertension_History = factor(Hypertension_History, levels = c("No", "Yes")),
    Family_History = factor(Family_History, levels = c("No", "Yes")),
    Heart_Attack_Occurrence = factor(Heart_Attack_Occurrence, levels = c("No", "Yes")),
    
    # Setting specific orders for more than 2 categorical factors
    Alcohol_Consumption = factor(Alcohol_Consumption, levels = c("None", "Low", "Moderate", "High")),
    Diet_Quality = factor(Diet_Quality, levels = c("Poor", "Average", "Good")),
    Physical_Activity = factor(Physical_Activity, levels = c("Low", "Moderate", "High")),
    AgeCat = factor(AgeCat, levels = c("Young", "Middle-Aged", "Old")),
    Stress = factor(Stress, levels = c("Low", "Medium", "High"))
  )
```

Lastly, save the prepared output to rds format using the following code chunk. We will use this newly prepared data from this point.

::: panel-tabset
## Save to .rds format

```{r}
write_rds(heartattack_data, file = "data/rds/heartattack.rds")
```

## Load the rds file

```{r}
heartattack <- read_rds("data/rds/heartattack.rds")
```
:::

We will also create a separate subset of the dataset for individuals who reported 'Yes' for Heart Attack Occurrence, enabling us to conduct further analysis and visualisations on the distribution with a focus on this specific group.

::: panel-tabset
## Subset

```{r}
yesheartattack <- heartattack %>%
  filter(Heart_Attack_Occurrence == "Yes")
```

## Save to .rds format

```{r}
write_rds(yesheartattack, file = "data/rds/yesheartattack.rds")
```

## Load the rds file

```{r}
yesheartattack <- read_rds("data/rds/yesheartattack.rds")
```
:::

------------------------------------------------------------------------

# 5 Data Visualisation

## 5.1 Visualising the Distributions

To begin, we first assess the distribution of heart attack occurrences in our dataset, which consists of 30,000 records. How many individuals experienced a heart attack? Is the dataset balanced in terms of heart attack cases versus non-cases?

Next, we examine the distribution of gender—are males and females equally represented? Similarly, we analyze the regional distribution to determine whether rural and urban populations are proportionally sampled in the data.

Understanding these proportions is crucial, as any significant imbalance could influence our analysis and the generalizability of our findings. By exploring these distributions, we can better assess potential biases and determine whether adjustments, such as weighting or stratified analysis, may be necessary moving forward.

Let's start by visualizing pie charts of the categorical variables in our full dataset.

```{r}
#| echo: False
# Function to create a pie chart
create_pie_chart <- function(data, fill_var, title, fill_label, colors) {
  ggplot(data, aes_string(x = "''", y = "Proportion", fill = fill_var)) +
    geom_bar(stat = "identity", width = 1) +
    coord_polar(theta = "y") +
    geom_text(aes_string(label = "scales::percent(Proportion, accuracy = 1)"), 
              position = position_stack(vjust = 0.5), size = 3) +
    scale_fill_manual(values = colors) + 
    labs(title = title, fill = fill_label, x = NULL, y = NULL) +
    theme_void() + 
    theme(plot.title = element_text(size=10),
      legend.title = element_text(size = 8, face = "bold"))
}

two_colors <- c("#9cc567", "#fcadb9")
three_colors <- c("#9cc567", "#83bace", "#fcadb9")

# Compute proportions
heart_attack_proportion <- heartattack %>%
  count(Heart_Attack_Occurrence) %>%
  mutate(Proportion = n / sum(n))

gender_proportion <- heartattack %>%
  count(Gender) %>%
  mutate(Proportion = n / sum(n))

region_proportion <- heartattack %>%
  count(Region) %>%
  mutate(Proportion = n / sum(n))

age_proportion <- heartattack %>%
  count(AgeCat) %>%
  mutate(Proportion = n / sum(n))

stress_proportion <- heartattack %>%
  count(Stress) %>%
  mutate(Proportion = n / sum(n))

heart_attack_pie <- create_pie_chart(heart_attack_proportion, "Heart_Attack_Occurrence", "Heart Attack Occurrence", "Heart Attack", two_colors)
gender_pie <- create_pie_chart(gender_proportion, "Gender", "Gender Distribution", "Gender", two_colors)
region_pie <- create_pie_chart(region_proportion, "Region", "Region Distribution", "Region", two_colors)
age_pie <- create_pie_chart(age_proportion, "AgeCat", "Age Distribution", "AgeCat", three_colors)
stress_pie <- create_pie_chart(stress_proportion, "Stress", "Stress Distribution", "Stress", three_colors)


(heart_attack_pie + gender_pie + region_pie) / (age_pie + stress_pie) + 
  plot_annotation(
    title = "Proportion of Heart Attack Occurrence, Gender, and Region")
```

From the pie charts, we saw that:

-   Only **10%** of individuals in the dataset have experienced a heart attack, while **90%** have not. This suggests an **imbalance** in the dataset, where heart attack cases are sampled much fewer than non-cases.

-   The dataset has an equal representation of **males (50%) and females (50%)**.This balance ensures that gender-related analyses are not biased toward one group over the other.

-   The underrepresentation of rural populations means findings may be more **urban-centric** unless adjustments are made. If rural populations are at different levels of heart attack risk, this imbalance may impact the generalizability of results.

-   Young age category is over represented as compared to middle-aged and old. Since this may overemphasize the vulnerabilitiy of young individuals, we will have to adjust this AgeCat variable for further analysis as shown in section 5.2.3.

-   In stress categories is the medium level is over represented as well. Since this may overemphasize the medium stress level, we will have to adjust this Stress variable for further analysis as shown in section 5.3.1.

## 5.2 Starting Big: Overview of Heart Attack Occurrence in Japan

### 5.2.1 Association of Heart Attack Occurrence with Continuous Factors

To determine whether numerical factors are associated with heart attack occurrence, we will first assess the distribution of each continuous variable. The following will be tested:

-   **Null Hypothesis:** There is no significant difference in continuous factors between individuals with and without a heart attack.

-   **Alternative Hypothesis**: There is a significant difference in continuous factors between individuals with and without a heart attack.

To decide whether to use the **Welch’s t-test** (for normally distributed data) or the **Mann-Whitney U test** (for non-normally distributed data), we will first check the normality of each continuous variable by plotting histograms as shown below. **`geom_histogram()`** from **ggplot2** package to plot the histograms.

```{r}
#| echo: False
# Function to plot histogram with density curve
plot_histogram <- function(data, variable, binwidth = NULL) {
  ggplot(data, aes_string(x = variable)) +
    geom_histogram(aes(y = ..density..), 
                   binwidth = binwidth, 
                   color = "black", fill = "#9ddcf2", alpha = 0.7) +
    geom_density(color = "red", size = 1) +
    labs(title = paste("Histogram of", variable), x = variable, y = "Density") +
    theme_minimal()
}

p1 <- plot_histogram(heartattack, "BMI", binwidth = 1)
p2 <- plot_histogram(heartattack, "Stress_Levels", binwidth = 1)
p3 <- plot_histogram(heartattack, "Cholesterol_Level", binwidth = 1)
p4 <- plot_histogram(heartattack, "Heart_Rate", binwidth = 1)
p5 <- plot_histogram(heartattack, "Systolic_BP", binwidth = 1)
p6 <- plot_histogram(heartattack, "Diastolic_BP", binwidth = 1)


(p1+p2)/(p3+p4)/(p5+p6)

```

Since all six continuous variables follow a normal distribution, we will use the **Welch’s t-test** for comparing means between groups. The **`ggbetweenstats()`** function from the **ggstatsplot** package allows us to visualize the distribution of a continuous variable across categorical groups while simultaneously performing statistical test to test our hypothesis. In this case, we will specify **Welch’s t-test** using `type = "p"` within `ggbetweenstats()`.

::: panel-tabset
## BMI + Stress

```{r}
#| echo: False
pp1<-ggbetweenstats(
  data = heartattack,
  x = Heart_Attack_Occurrence, 
  y = BMI,
  type = "p",
  messages = FALSE
)

pp2<-ggbetweenstats(
  data = heartattack,
  x = Heart_Attack_Occurrence, 
  y = Stress_Levels,
  type = "p",
  messages = FALSE
)

pp1 + pp2
```

## Cholesterol + Heart Rate

```{r}
#| echo: False
pp3<-ggbetweenstats(
  data = heartattack,
  x = Heart_Attack_Occurrence, 
  y = Cholesterol_Level,
  type = "p",
  messages = FALSE
)

pp4<-ggbetweenstats(
  data = heartattack,
  x = Heart_Attack_Occurrence, 
  y = Heart_Rate,
  type = "p",
  messages = FALSE
)

pp3 +pp4
```

## Systolic + Diastolic BP

```{r}
#| echo: False
pp5<-ggbetweenstats(
  data = heartattack,
  x = Heart_Attack_Occurrence, 
  y = Systolic_BP,
  type = "p",
  messages = FALSE
)

pp6<-ggbetweenstats(
  data = heartattack,
  x = Heart_Attack_Occurrence, 
  y = Diastolic_BP,
  type = "p",
  messages = FALSE
)

pp5+pp6
```
:::

### 5.2.2 Association of Heart Attack Occurrence with Categorical Factors

Next, we will conduct hypothesis testing for the categorical variables as well. We will use **`ggbarstats()`** from the **ggstatsplot** package to assess statistical significance while visualizing the proportions and distribution of categorical factors in a stacked bar chart. This function performs appropriate statistical tests to determine associations between categorical variables.

::: panel-tabset
## Diabetes + Alcohol Consumption

```{r}
#| echo: False
# Diabetes plot
diabetes_history <- ggbarstats(
  data = heartattack, 
  x = Diabetes_History, 
  y = Heart_Attack_Occurrence
)+ 
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_blank())+
  coord_flip()

# Alcohol Consumption plot
alcohol <- ggbarstats(
  data = heartattack, 
  x = Alcohol_Consumption, 
  y = Heart_Attack_Occurrence
)+
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_blank()) + 
  coord_flip()


diabetes_history/alcohol + 
  plot_annotation(title = "Statistical Association Between Categorical Factors & Having Had Heart Attack (Yes/No)")
```

## Smoking + Family History

```{r}
#| echo: False
# Smoking History plot
smoking <- ggbarstats(
  data = heartattack, 
  x = Smoking_History, 
  y = Heart_Attack_Occurrence)+
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_blank()) + 
  coord_flip()

# Family History plot
family_history <- ggbarstats(
  data = heartattack, 
  x = Family_History, 
  y = Heart_Attack_Occurrence
)+
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_blank()) + 
  coord_flip()

smoking/family_history+ 
  plot_annotation(title = "Statistical Association Between Categorical Factors & Having Had Heart Attack (Yes/No)")
```

## Diet Quality + Physical Activity

```{r}
#| echo: False
# diet plot
diet <- ggbarstats(
  data = heartattack, 
  x = Diet_Quality, 
  y = Heart_Attack_Occurrence
)+ 
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_blank())+
  coord_flip()

# Physical Activity plot
physical_act <- ggbarstats(
  data = heartattack, 
  x = Physical_Activity, 
  y = Heart_Attack_Occurrence
)+
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_blank()) + 
  coord_flip()


diet/physical_act + 
  plot_annotation(title = "Statistical Association Between Categorical Factors & Having Had Heart Attack(Yes/No)")
```
:::

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

-   The Welch’s t-test for Stress Level has a p-value of 0.04, indicating a statistically significant difference in stress levels between individuals with and without a heart attack.

-   The mean stress level is slightly lower for individuals who had a heart attack (4.93) compared to those who did not (5.01), but the effect size (g hedges​=0.04) suggests a very small difference. While statistically significant, this difference may not be clinically meaningful.

-   BMI, Cholesterol Level, Heart Rate, Systolic BP, Diastolic BP and all categorical variables had p-values greater than 0.05, indicating no significant differences between individuals with and without a heart attack. This suggests that these factors, in isolation, do not show strong evidence of a direct association with heart attack occurrence in this dataset.

-   Apart from Stress, we **fail to reject** the null hypothesis that there is no significant difference between individuals with and without a heart attack for the rest of the variables.
:::

### 5.2.3 Overview of Heart Attack Cases: The Demographics

Now that we have an understanding of the distributions and significance of the variables against heart attack occurrence, we will first explore the distribution of heart attack occurrences across different age groups and genders in Japan. By categorizing individuals into age groups (Young, Middle-Aged, and Old), we can observe trends in heart attack prevalence, with particular focus on gender differences. This helps identify which demographic groups are more vulnerable and gives us the overview.

::: {.callout-important style="color: black; background-color: #f0dcdc"}
## Adjustment for Age Category Imbalance

In section 5.1, it was observed that the Young Age Group (36%) is naturally more represented in the dataset. If we analyze the data without adjustment, this could lead to an overemphasis on the risk of heart attacks among young individuals. To mitigate this potential bias, we will normalize the prevalence of heart attacks within each age group by accounting for their overall representation in the dataset.

The prevalence of heart attack in each age category will be calculated using the following formula:

$PrevalenceAgeCat$ = Number of Heart Attack Cases in Age Group/ Total Individuals in Age Group

This adjustment ensures that the analysis of heart attack risk is proportionate to the actual representation of each age group in the dataset, providing more accurate insights into the relationship between age and heart attack prevalence.
:::

For this visualization, we will use **`geom_bar()`** from the **ggplot2** package to create bar charts and leverage the **patchwork** package to seamlessly combine multiple bar charts into a cohesive layout.

::: panel-tabset
## The Plot

```{r}
#| echo: False
# Compute total individuals in each age category (from full dataset)
total_age_counts <- heartattack %>%
  group_by(AgeCat) %>%
  summarise(TotalCount = n())

# Compute number of heart attack cases in each age category (from filtered dataset)
age_summary <- yesheartattack %>%
  group_by(AgeCat) %>%
  summarise(HeartAttackCases = n()) %>%
  left_join(total_age_counts, by = "AgeCat") %>%
  mutate(PrevalenceAgeCat = (HeartAttackCases / TotalCount) * 100)

custom_colors <- c("Young" = "#ffe372", "Middle-Aged" = "#9cc567", "Old" = "#e79251")

# Plot 1: Heart Attack Occurrence by Age Category 
p1 <- ggplot(age_summary, aes(x = AgeCat, y = PrevalenceAgeCat, fill = AgeCat)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = sprintf("%.2f%%", PrevalenceAgeCat)), vjust = 1.5, size = 3) +  
  scale_fill_manual(values = custom_colors) +
  labs(x = "Age Category") +  
  theme_minimal() +
  theme(legend.position = "none", plot.title = element_blank(), 
        axis.title.y = element_blank(),axis.text.y = element_blank(), axis.title.x = element_blank())  

# Compute percentage of Heart Attack Occurrence for each Gender
gender_summary <- yesheartattack %>%
  group_by(Gender) %>%
  summarise(Percentage = (n() / nrow(yesheartattack)) * 100)

# Plot 2: Heart Attack Occurrence by Gender 
p2 <- ggplot(gender_summary, aes(x = Gender, y = Percentage, fill = Gender)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), vjust = 1.5, size = 3) + 
  labs(x = "Gender") +
  theme_minimal() +
  theme(legend.position = "none", plot.title = element_blank(), axis.title.y = element_blank(),axis.text.y = element_blank(),axis.title.x = element_blank())+
  scale_fill_manual(values = c("Female" = "#f7a8b8", "Male" = "#83bace"))

# Compute total individuals for each Gender-Age category
total_gender_age_counts <- heartattack %>%
  group_by(Gender, AgeCat) %>%
  summarise(TotalCount = n())

# Compute heart attack cases for each Gender-Age category
gender_age_summary <- yesheartattack %>%
  group_by(Gender, AgeCat) %>%
  summarise(HeartAttackCases = n()) %>%
  left_join(total_gender_age_counts, by = c("Gender", "AgeCat")) %>%
  mutate(PrevalenceAgeCat = (HeartAttackCases / TotalCount) * 100)

# Gender-Age Barplot
p3 <- ggplot(gender_age_summary, aes(x = Gender, y = PrevalenceAgeCat, fill = AgeCat)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +  
  geom_text(aes(label = sprintf("%.1f%%", PrevalenceAgeCat)), 
            position = position_dodge(width = 0.9), vjust = 1.5, size = 3) + 
  scale_fill_manual(values = custom_colors) +
  labs(x = "Gender", y = "Prevalence of Heart Attack Cases (%)", fill = "Age Category") +
  theme_minimal()+
  theme(axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.y = element_blank())



(p1 + p2)/ p3 + 
  plot_layout(widths = c(1, 1, 1.5)) +  
  plot_annotation(title = "Proportion of Heart Attack Cases in Age Groups and Gender")
```

## The Code

```{r}
#| eval: False
# Compute total individuals in each age category (from full dataset)
total_age_counts <- heartattack %>%
  group_by(AgeCat) %>%
  summarise(TotalCount = n())

# Compute number of heart attack cases in each age category (from filtered dataset)
age_summary <- yesheartattack %>%
  group_by(AgeCat) %>%
  summarise(HeartAttackCases = n()) %>%
  left_join(total_age_counts, by = "AgeCat") %>%
  mutate(PrevalenceAgeCat = (HeartAttackCases / TotalCount) * 100)

custom_colors <- c("Young" = "#ffe372", "Middle-Aged" = "#9cc567", "Old" = "#e79251")

# Plot 1: Heart Attack Occurrence by Age Category 
p1 <- ggplot(age_summary, aes(x = AgeCat, y = PrevalenceAgeCat, fill = AgeCat)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = sprintf("%.2f%%", PrevalenceAgeCat)), vjust = 1.5, size = 3) +  
  scale_fill_manual(values = custom_colors) +
  labs(x = "Age Category") +  
  theme_minimal() +
  theme(legend.position = "none", plot.title = element_blank(), 
        axis.title.y = element_blank(),axis.text.y = element_blank(), axis.title.x = element_blank())  

# Compute percentage of Heart Attack Occurrence for each Gender
gender_summary <- yesheartattack %>%
  group_by(Gender) %>%
  summarise(Percentage = (n() / nrow(yesheartattack)) * 100)

# Plot 2: Heart Attack Occurrence by Gender 
p2 <- ggplot(gender_summary, aes(x = Gender, y = Percentage, fill = Gender)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), vjust = 1.5, size = 3) + 
  labs(x = "Gender") +
  theme_minimal() +
  theme(legend.position = "none", plot.title = element_blank(), axis.title.y = element_blank(),axis.text.y = element_blank(),axis.title.x = element_blank())+
  scale_fill_manual(values = c("Female" = "#f7a8b8", "Male" = "#83bace"))

# Compute total individuals for each Gender-Age category
total_gender_age_counts <- heartattack %>%
  group_by(Gender, AgeCat) %>%
  summarise(TotalCount = n())

# Compute heart attack cases for each Gender-Age category
gender_age_summary <- yesheartattack %>%
  group_by(Gender, AgeCat) %>%
  summarise(HeartAttackCases = n()) %>%
  left_join(total_gender_age_counts, by = c("Gender", "AgeCat")) %>%
  mutate(PrevalenceAgeCat = (HeartAttackCases / TotalCount) * 100)

# Gender-Age Barplot
p3 <- ggplot(gender_age_summary, aes(x = Gender, y = PrevalenceAgeCat, fill = AgeCat)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +  
  geom_text(aes(label = sprintf("%.1f%%", PrevalenceAgeCat)), 
            position = position_dodge(width = 0.9), vjust = 1.5, size = 3) + 
  scale_fill_manual(values = custom_colors) +
  labs(x = "Gender", y = "Prevalence of Heart Attack Cases (%)", fill = "Age Category") +
  theme_minimal()+
  theme(axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.y = element_blank())



(p1 + p2)/ p3 + 
  plot_layout(widths = c(1, 1, 1.5)) +  
  plot_annotation(title = "Proportion of Heart Attack Cases in Age Groups and Gender")
```
:::

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

-   **Males have a slightly higher proportion of heart attack cases than females**, suggesting gender may be a factor.
-   **Among those who experienced heart attacks**, a higher percentage are in the **Middle Aged Group (10.0%)**.
    -   Among females, the Old Age Group is the most vulnerable.

    -   Among males, the Middle-Aged Age Group appears to be the most vulnerable to heart attacks.
:::

## 5.3 Zooming in: Vulnerability in Young vs Old Individuals

Understanding heart attack vulnerability requires examining how risk factors differ across age groups. Young and old individuals present distinct physiological, behavioral, and lifestyle characteristics that influence heart attack risk. Young individuals may experience heart attacks due to factors such as stress, lifestyle habits, or underlying conditions, while older individuals often face risks associated with long-term health issues, including hypertension, cholesterol, and cardiovascular disease.

By focusing on these two age groups, we aim to uncover key differences in how heart attacks manifest and what factors contribute most significantly to their occurrence. This targeted approach allows us to explore whether certain risk factors, such as stress, have a stronger impact in one group over the other, ultimately providing more age-specific insights into heart attack prevention and management.

### 5.3.1 Focusing on Stress among Heart Attack Cases

Stress is a well known contributor to heart disease, but its impact may vary depending on age. In young individuals, stressors such as work pressure, financial concerns, and lifestyle choices may lead to sudden cardiovascular strain, increasing heart attack risk. In contrast, for older individuals, chronic stress and cumulative health burdens can contribute to long-term cardiovascular deterioration.

Given the significance of stress in heart attack occurrences, as identified in Section 5.1.2, this section examines how stress levels differ between young and old individuals and whether these variations influence heart attack vulnerability. By analyzing these distinctions, we can better understand whether stress acts as a more immediate or gradual risk factor across different age demographics.

::: {.callout-important style="color: black; background-color: #f0dcdc"}
## Adjustment for Stress Category Imbalance

As found in section 5.1, in our dataset, the Stress category distribution is imbalanced, with the following proportions:

-   Medium: 53%

-   Low: 31%

-   High: 16%

If we use the Stress categories as they are, the medium category would be disproportionately represented. To ensure more accurate insights and prevent overemphasis on the medium stress group, we will first analyze within each stress category before visualizing the results.

To achieve this, we calculate **proportion of young/middle-age/old individuals within each stress group** (i.e. Number of Young individuals in each Stress Category who experienced Heart Attack​/ Total Number of Heart Attack Cases in each Stress Category)
:::

For this visualization, we will use **`ggbetweenstats()`** to test whether there is a significant association between age categories and stress levels. Additionally, **`geom_boxplot()`** will be used to compare stress levels between younger and older individuals, while **`geom_bar()`** from the **ggplot2** package will create bar charts to display the distribution of stress levels across age categories. Finally, the **patchwork** package will be used to combine these plots into a cohesive and structured layout.

::: panel-tabset
## The Plot

```{r}
#| echo: False
# Compute total number of "Yes" Heart Attack cases in each Stress category
total_stress_counts <- yesheartattack %>%
  group_by(Stress) %>%
  summarise(TotalCount = n())

# Count the number of "Yes" Heart Attack cases for each AgeCat and Stress category
age_stress_counts <- yesheartattack %>%
  filter(AgeCat %in% c("Young", "Old")) %>%
  group_by(AgeCat, Stress) %>%
  summarise(Count = n(),.groups = "drop")

# Join the counts with the total Stress counts to calculate normalized proportions
normalized_stress <- age_stress_counts %>%
  left_join(total_stress_counts, by = "Stress") %>%
  mutate(NormalizedStress = Count / TotalCount)

# Plot normalized Stress proportions for each AgeCat
stressplot <- ggplot(normalized_stress, aes(x = AgeCat, y = NormalizedStress, fill = Stress)) +
  geom_bar(stat = "identity", position = "dodge") +  
  geom_text(aes(label = sprintf("%.1f%%", NormalizedStress * 100)), 
            position = position_dodge(width = 0.8), vjust = 1.5, size = 2) +  
  scale_fill_manual(values = c("Low" = "#ffcccc", "Medium" = "#83bace", "High" = "#608e24")) +
  labs(x = "Age Category", y = "Normalized Stress Proportion") +
  theme_minimal() +
  theme(legend.position = "right",
        legend.title= element_text(size=7),
        legend.text= element_text(size=5),
        plot.title = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank())

# Filter for Young and Old categories
heartattack_filtered <- yesheartattack %>%
  filter(AgeCat %in% c("Young", "Old"))

#Distribution of stress in Young/Old
# Calculate the statistics
stats <- heartattack_filtered %>%
  group_by(AgeCat) %>%
  summarise(
    median = median(Stress_Levels),
    Q1 = quantile(Stress_Levels, 0.25),
    Q3 = quantile(Stress_Levels, 0.75),
    .groups = "drop"
  )

# Boxplot
stress_box<- ggplot(heartattack_filtered, aes(x = AgeCat, y = Stress_Levels, fill = AgeCat)) +
  geom_boxplot() +
  geom_text(data = stats, 
            aes(x = AgeCat, 
                y = median, 
                label = paste("Median:", round(median, 2))), 
            position = position_nudge(y = 0.5), size = 2) +
  geom_text(data = stats, 
            aes(x = AgeCat, 
                y = Q1, 
                label = paste("25th Percentile:", round(Q1, 2))), 
            position = position_nudge(y = -0.5), size = 2) +
  geom_text(data = stats, 
            aes(x = AgeCat, 
                y = Q3, 
                label = paste("75th Percentile:", round(Q3, 2))), 
            position = position_nudge(y = 0.5), size = 2) +
  labs(
       x = "Age Category",
       y = "Stress Level") +
  theme_minimal() +
  scale_fill_manual(values = c("Young" = "#ffe372", "Old" = "#e5ae85"))+
  theme(legend.position = "none",
        plot.title = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank())


#Anova
anova_stress <- ggbetweenstats(
  data = yesheartattack,
  x = AgeCat, 
  y = Stress_Levels,
  type = "p",
  mean.ci = TRUE, 
  pairwise.comparisons = TRUE, 
  pairwise.display = "s",
  p.adjust.method = "fdr",
  messages = FALSE
)+
  theme(axis.title.x = element_blank())

anova_stress+stress_box+stressplot + 
  plot_layout(widths = c(1, 0.8, 0.8)) +  
  plot_annotation(title = "Stress Level of Heart Attack Cases by Age Category")
```

## The Code

```{r}
#| eval: False
# Compute total number of "Yes" Heart Attack cases in each Stress category
total_stress_counts <- yesheartattack %>%
  group_by(Stress) %>%
  summarise(TotalCount = n())

# Count the number of "Yes" Heart Attack cases for each AgeCat and Stress category
age_stress_counts <- yesheartattack %>%
  filter(AgeCat %in% c("Young", "Old")) %>%
  group_by(AgeCat, Stress) %>%
  summarise(Count = n(),.groups = "drop")

# Join the counts with the total Stress counts to calculate normalized proportions
normalized_stress <- age_stress_counts %>%
  left_join(total_stress_counts, by = "Stress") %>%
  mutate(NormalizedStress = Count / TotalCount)

# Plot normalized Stress proportions for each AgeCat
stressplot <- ggplot(normalized_stress, aes(x = AgeCat, y = NormalizedStress, fill = Stress)) +
  geom_bar(stat = "identity", position = "dodge") +  
  geom_text(aes(label = sprintf("%.1f%%", NormalizedStress * 100)), 
            position = position_dodge(width = 0.8), vjust = 1.5, size = 2) +  
  scale_fill_manual(values = c("Low" = "#ffcccc", "Medium" = "#83bace", "High" = "#608e24")) +
  labs(x = "Age Category", y = "Normalized Stress Proportion") +
  theme_minimal() +
  theme(legend.position = "right",
        legend.title= element_text(size=7),
        legend.text= element_text(size=5),
        plot.title = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank())

# Filter for Young and Old categories
heartattack_filtered <- yesheartattack %>%
  filter(AgeCat %in% c("Young", "Old"))

#Distribution of stress in Young/Old
# Calculate the statistics
stats <- heartattack_filtered %>%
  group_by(AgeCat) %>%
  summarise(
    median = median(Stress_Levels),
    Q1 = quantile(Stress_Levels, 0.25),
    Q3 = quantile(Stress_Levels, 0.75),
    .groups = "drop"
  )

# Boxplot
stress_box<- ggplot(heartattack_filtered, aes(x = AgeCat, y = Stress_Levels, fill = AgeCat)) +
  geom_boxplot() +
  geom_text(data = stats, 
            aes(x = AgeCat, 
                y = median, 
                label = paste("Median:", round(median, 2))), 
            position = position_nudge(y = 0.5), size = 2) +
  geom_text(data = stats, 
            aes(x = AgeCat, 
                y = Q1, 
                label = paste("25th Percentile:", round(Q1, 2))), 
            position = position_nudge(y = -0.5), size = 2) +
  geom_text(data = stats, 
            aes(x = AgeCat, 
                y = Q3, 
                label = paste("75th Percentile:", round(Q3, 2))), 
            position = position_nudge(y = 0.5), size = 2) +
  labs(
       x = "Age Category",
       y = "Stress Level") +
  theme_minimal() +
  scale_fill_manual(values = c("Young" = "#ffe372", "Old" = "#e5ae85"))+
  theme(legend.position = "none",
        plot.title = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank())


#Anova
anova_stress <- ggbetweenstats(
  data = yesheartattack,
  x = AgeCat, 
  y = Stress_Levels,
  type = "p",
  mean.ci = TRUE, 
  pairwise.comparisons = TRUE, 
  pairwise.display = "s",
  p.adjust.method = "fdr",
  messages = FALSE
)+
  theme(axis.title.x = element_blank())

anova_stress+stress_box+stressplot + 
  plot_layout(widths = c(1, 0.8, 0.8)) +  
  plot_annotation(title = "Stress Level of Heart Attack Cases by Age Category")
```
:::

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

-   When conducting a Welch's one-way ANOVA test to examine the relationship between Stress levels and Age categories among heart attack patients, the test resulted in a p-value of 0.02, indicating a significant difference in stress levels between young and old patients. On average, older patients had a higher stress level (mean = 5.07) compared to younger patients (mean = 4.83).

-   Boxplot analysis further supports this finding, showing that older patients have a higher median stress level of 5.19, whereas younger patients have a median of 4.83. Additionally, the interquartile range (IQR) is higher for older individuals, meaning both the 25th and 75th percentiles of stress levels are elevated in this group.

-   When examining stress categories, young heart attack patients were most commonly found in the Low Stress category, with 38.2% of cases. In contrast, older individuals had a greater proportion of heart attack cases in the Medium and High Stress categories. This aligns with the boxplot observations, reinforcing that older heart attack patients generally experience higher stress levels compared to younger patients.
:::

### 5.3.2 Stress Levels in Systolic vs Diastolic Blood Pressure

Blood pressure (BP) is a critical indicator of cardiovascular health, with fluctuations often linked to stress levels. Research has shown that prolonged exposure to stress can contribute to blood pressure dysregulation, increasing the risk of cardiovascular events, including heart attacks (Gordon & Mendes, 2021).

Systolic blood pressure (SBP) measures the pressure exerted on artery walls when the heart contracts, while diastolic blood pressure (DBP) reflects the pressure during heart relaxation. Understanding the relationship between stress and both BP components helps assess how stress-induced cardiovascular responses vary between individuals.

We will visualize both SBP and DBP using `geom_boxplot()` from the **ggplot2** package, with the plots faceted by stress levels. This approach allows for a clear comparison of different age categories within each stress level.

::: panel-tabset
## The Plot

```{r}
#| echo: False
# Boxplot to compare diastolic BP distribution by stress level and age group
dia <- ggplot(yesheartattack, aes(x = AgeCat, y = Diastolic_BP, fill = AgeCat)) +
  geom_boxplot() +
  facet_wrap(~ Stress) +  # Remove scales = 'free' to make y-axis same for all facets
  stat_summary(fun = median, geom = "text", aes(label = round(..y.., 2)), 
               vjust = -0.5, color = "black", size = 3) +  # Add median text
  labs(title = "Distribution of Diastolic BP and Systolic BP by Stress Level and Age Group",
       x = "Age Group",
       y = "Diastolic BP (mmHg)") +
  scale_fill_manual(values = c("Young" = "#ffde59", "Middle-Aged" = "#9cc567", "Old" = "#fcadb9")) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none")

# Boxplot to compare systolic BP distribution by stress level and age group
sys <- ggplot(yesheartattack, aes(x = AgeCat, y = Systolic_BP, fill = AgeCat)) +
  geom_boxplot() +
  facet_wrap(~ Stress) +  # Remove scales = 'free' to make y-axis same for all facets
  stat_summary(fun = median, geom = "text", aes(label = round(..y.., 2)), 
               vjust = -0.5, color = "black", size = 3) +  # Add median text
  labs(x = "Age Group",
       y = "Systolic BP (mmHg)") +
  scale_fill_manual(values = c("Young" = "#ffde59", "Middle-Aged" = "#9cc567", "Old" = "#fcadb9")) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        plot.title = element_blank(),
        strip.text = element_blank(),  # Removes "Low," "Medium," "High" labels
        legend.position = "none")

dia / sys

```

## The Code

```{r}
#| eval: False
# Boxplot to compare diastolic BP distribution by stress level and age group
dia <- ggplot(yesheartattack, aes(x = AgeCat, y = Diastolic_BP, fill = AgeCat)) +
  geom_boxplot() +
  facet_wrap(~ Stress) +  # Remove scales = 'free' to make y-axis same for all facets
  stat_summary(fun = median, geom = "text", aes(label = round(..y.., 2)), 
               vjust = -0.5, color = "black", size = 3) +  # Add median text
  labs(title = "Distribution of Diastolic BP and Systolic BP by Stress Level and Age Group",
       x = "Age Group",
       y = "Diastolic BP (mmHg)") +
  scale_fill_manual(values = c("Young" = "#ffde59", "Middle-Aged" = "#9cc567", "Old" = "#fcadb9")) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none")

# Boxplot to compare systolic BP distribution by stress level and age group
sys <- ggplot(yesheartattack, aes(x = AgeCat, y = Systolic_BP, fill = AgeCat)) +
  geom_boxplot() +
  facet_wrap(~ Stress) +  # Remove scales = 'free' to make y-axis same for all facets
  stat_summary(fun = median, geom = "text", aes(label = round(..y.., 2)), 
               vjust = -0.5, color = "black", size = 3) +  # Add median text
  labs(x = "Age Group",
       y = "Systolic BP (mmHg)") +
  scale_fill_manual(values = c("Young" = "#ffde59", "Middle-Aged" = "#9cc567", "Old" = "#fcadb9")) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        plot.title = element_blank(),
        strip.text = element_blank(),  # Removes "Low," "Medium," "High" labels
        legend.position = "none")

dia / sys
```
:::

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

-   Both SBP and DBP appear to be relatively stable across stress levels, with only slight variations.

-   Older individuals tend to have higher median SBP and DBP, likely due to reduced arterial elasticity and increased vascular resistance with aging.

-   Diastolic BP:

    -   Young individuals exhibited a decline in median DBP with increasing stress, suggesting possible acute stress adaptation or a physiological response.

    -   Older individuals showed a slight increase in DBP with higher stress, which could be attributed to chronic stress effects.

-   Systolic BP:

    -   Young individuals also show a slight decrease in SBP under high stress, reinforcing the idea that they may have better cardiovascular adaptability.

    -   Older individuals see a moderate rise in SBP with high stress, which aligns with the DBP trend, suggesting stress-induced hypertension risk.

-   Middle-aged individuals exhibit the most stable blood pressure across stress levels, possibly due to adaptation mechanisms.

-   Diastolic BP shows a stronger age-dependent variation under stress than Systolic BP.
:::

### 5.3.3 Stress Levels in Diastolic Blood Pressure

Among the two blood pressure metrics, diastolic BP demonstrated a stronger and statistically significant correlation with stress levels. This finding motivated a more in-depth analysis of DBP in response to stress across different age groups.

This section examines the variations in DBP across different stress levels, comparing young and old individuals. By analyzing these patterns, we aim to determine whether stress contributes differently to blood pressure fluctuations across age groups, which could have implications for heart attack risk.

::: {.callout-important style="color: black; background-color: #f0dcdc"}
## Why Diastolic BP is important

Systolic blood pressure reflects the pressure in the arteries when the heart beats, while diastolic blood pressure reflects the pressure between beats when the heart is at rest. Diastolic pressure is often used in clinical settings to gauge the health of the blood vessels and heart's ability to relax. Given the context of this study, which seeks to explore the impact of stress on heart function, diastolic blood pressure provides a more relevant and sensitive measure of how stress affects the body's ability to regulate blood flow.
:::

We will first use **`ggscatterstats()`** to examine whether there is a significant correlation between **DBP** and **stress levels**. Then, we will visualize the distribution of **DBP** across different stress levels using a combination of **`stat_halfeye()`** and **`geom_boxplot()`** from the **ggplot2** package, providing a detailed view of the data distribution and variability.

::: panel-tabset
## Correlation Analysis - DBP vs Stress

```{r}
ggscatterstats(
  data = yesheartattack,
  x = Stress_Levels,
  y = Diastolic_BP,
  marginal = FALSE,
  )
```

## The Plot: Distribution of Diastolic BP

```{r}
#| echo: False
ggplot(heartattack_filtered, aes(x = Stress, y = Diastolic_BP, fill = AgeCat)) +
  stat_halfeye(adjust = 0.5, 
               justification = -0.2, 
               .width = 0, 
               point_colour = NA, 
               alpha = 0.4) +  # Density plot
  geom_boxplot(width = 0.2, 
               outlier.shape = 16,  
               outlier.color = "black", 
               outlier.size = 1.5, 
               alpha = 0.7) +  
  stat_summary(fun = median, geom = "text",
               aes(label = paste0("Median = ", round(..y.., 1))),
               position = position_dodge(width = 0.8),
               vjust = 0.3, size = 3, color = "black") +  # Add median text
  coord_flip() +  # Flip for better readability
  scale_fill_manual(values = c("Young" = "#63b2e3", "Old" = "#f1b6b1")) + 
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.8))) +
  labs(title = "Diastolic BP Across Stress Levels",
       x = "Stress Levels",
       y = "Diastolic Blood Pressure (mmHg)",
       fill = "Age Category") +
  theme_economist() + 
  theme(legend.position = "top",
        legend.text=element_text(size=8),
        legend.title=element_blank(),
        axis.title.y = element_blank())

```

## The Code

```{r}
#| eval: False
ggplot(heartattack_filtered, aes(x = Stress, y = Diastolic_BP, fill = AgeCat)) +
  stat_halfeye(adjust = 0.5, 
               justification = -0.2, 
               .width = 0, 
               point_colour = NA, 
               alpha = 0.4) +  # Density plot
  geom_boxplot(width = 0.2, 
               outlier.shape = 16,  
               outlier.color = "black", 
               outlier.size = 1.5, 
               alpha = 0.7) +  
  stat_summary(fun = median, geom = "text",
               aes(label = paste0("Median = ", round(..y.., 1))),
               position = position_dodge(width = 0.8),
               vjust = 0.3, size = 3, color = "black") +  # Add median text
  coord_flip() +  # Flip for better readability
  scale_fill_manual(values = c("Young" = "#63b2e3", "Old" = "#f1b6b1")) + 
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.8))) +
  labs(title = "Diastolic BP Across Stress Levels",
       x = "Stress Levels",
       y = "Diastolic Blood Pressure (mmHg)",
       fill = "Age Category") +
  theme_economist() + 
  theme(legend.position = "top",
        legend.text=element_text(size=8),
        legend.title=element_blank(),
        axis.title.y = element_blank())
```
:::

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

-   The analysis reveals a significant correlation between stress and diastolic blood pressure (DBP), with a p-value of 0.02 indicating that stress levels do indeed have an effect on DBP. The correlation coefficient (R) of -0.04 suggests a very weak negative relationship between stress and DBP, implying that, on the whole, higher stress levels are slightly associated with lower diastolic blood pressure. However, looking at the 95% confidence interval for the correlation, which ranges from -0.08 to -0.008, we can conclude that while the relationship between stress and DBP is statistically significant, its strength is not substantial.
-   The spread (IQR) of diastolic BP is wider for young individuals across all stress levels, meaning their BP varies more compared to older individuals. The density plots show that the diastolic BP distribution is slightly more concentrated for older individuals, suggesting more consistency in their BP readings.
-   For young individuals, the inverse relationship between stress and diastolic blood pressure is intriguing. Specifically, those experiencing higher levels of stress have lower median diastolic blood pressure. This could potentially be related to lifestyle factors common among younger populations, such as increased physical activity or lower levels of chronic conditions, which might help mitigate the expected increases in blood pressure with stress.
-   For older individuals, there is an direct relationship between stress and diastolic BP:
    -   Older individuals with low stress have the lowest median BP (79.5 mmHg).

    -   Those with high stress have a higher median BP (80.4 mmHg).

    -   This could suggest that older individuals under high stress might have increased risk of heart attack.
:::

### 5.3.4 Does Gender and Regions Matter?

Exploring the impact of gender and region (urban vs. rural) on the occurrence of heart attacks in relation to varying stress levels can reveal important insights into cardiovascular risk disparities. By examining how gender and region interact with different stress levels, we aim to identify significant patterns that may highlight increased vulnerability to heart attacks.

We will use a **`stat_halfeye()`** and **`geom_boxplot()`** from **ggplot2** to visualize gender differences, as well as a boxplot to compare differences between individuals with and without heart attacks. Similarly, we will apply the **`stat_halfeye()`** and **`geom_boxplot()`** to examine regional differences (urban vs. rural). Lastly, we will include an interaction term between gender and region (e.g., **Female.Urban** and **Male.Urban**) to visualize the proportions of heart attack cases within these groups, helping us identify which demographic groups may be more vulnerable.

::: panel-tabset
## Gender

```{r}
#| echo: False
# Calculate summary statistics for Age vs Stress by Gender
summary_stats_gen <- yesheartattack %>%
  group_by(AgeCat, Gender) %>%
  summarise(
    Q25 = quantile(Stress_Levels, 0.25, na.rm = TRUE),
    median_BP = median(Stress_Levels, na.rm = TRUE),
    Q75 = quantile(Stress_Levels, 0.75, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    label = paste("25th: ", round(Q25, 1), 
                  "\nMedian: ", round(median_BP, 1), 
                  "\n75th: ", round(Q75, 1))
  )

# Half eye plot for Age vs Stress by Gender with adjusted text placement
halfeyegen <- ggplot(yesheartattack, 
       aes(x = AgeCat, 
           y = Stress_Levels, 
           fill = AgeCat)) +
  stat_halfeye(adjust = 0.5,
               justification = -0.2,
               .width = 0,
               point_colour = NA) +
  geom_boxplot(width = .20,
               outlier.shape = NA) +
  facet_wrap(~ Gender) +
  geom_text(data = summary_stats_gen, 
            aes(x = AgeCat, 
                y = Q25 - 2,  # Place 25th percentile lower
                label = paste("25th: ", round(Q25, 1))), 
            size = 3, color = "black", vjust = -4.5) +  
  geom_text(data = summary_stats_gen, 
            aes(x = AgeCat, 
                y = median_BP,  # Place median in the middle
                label = paste("Median: ", round(median_BP, 1))), 
            size = 3, color = "black", vjust = -0.3) +  
  geom_text(data = summary_stats_gen, 
            aes(x = AgeCat, 
                y = Q75 + 2,  # Place 75th percentile higher
                label = paste("75th: ", round(Q75, 1))), 
            size = 3, color = "black", vjust = 4.5) +  
  labs(title = "Age vs Stress by Gender", 
       x = "Age", 
       y = "Stress")+
  scale_fill_manual(values = c("Young" = "#ffde59", "Middle-Aged" = "#e79251", "Old" = "#fcadb9")) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        legend.position = "none")

# Summary stats for stress levels by heart attack occurrence
summary_stats_heart <- heartattack %>%
  group_by(Gender, Heart_Attack_Occurrence) %>%
  summarise(
    median_val = median(Stress_Levels, na.rm = TRUE),
    .groups = "drop"
  )

# Boxplot for Stress Levels by Heart Attack Occurrence
boxgen <- ggplot(heartattack, aes(x = Heart_Attack_Occurrence, y = Stress_Levels, fill = Heart_Attack_Occurrence)) +
  geom_boxplot() +
  geom_text(data = summary_stats_heart, 
            aes(x = Heart_Attack_Occurrence, 
                y = median_val, 
                label = paste("Median: ", round(median_val, 2))), 
            vjust = -0.5, size = 3) +
  facet_wrap(~ Gender, scales = 'free') +  # Facet by gender
  scale_fill_manual(values = c("Yes" = "#83bace", "No" = "#9cc567")) +
  labs(title = "Stress Levels by Heart Attack Occurrence",
       x = "Heart Attack",
       y = "Stress Level") +
  theme_minimal() +
  theme(
        axis.title.x = element_blank(),
        legend.position = "none") +
  coord_flip()

# Combine plots with layout adjustments
halfeyegen / boxgen + plot_layout(heights = c(1.5, 0.5))
```

## Region

```{r}
#| echo: False
# Calculate the statistics for labels
summary_stats <- yesheartattack %>%
  group_by(AgeCat, Region) %>%
  summarise(
    median_BP = median(Stress_Levels, na.rm = TRUE),
    Q25 = quantile(Stress_Levels, 0.25, na.rm = TRUE),
    Q75 = quantile(Stress_Levels, 0.75, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    label = paste("25th: ", round(Q25, 1),
                  "\nMedian: ", round(median_BP, 1),
                  "\n75th: ", round(Q75, 1))
  )

# Half eye plot for Age vs Stress by Gender with adjusted text placement
halfeyereg <- ggplot(yesheartattack, 
       aes(x = AgeCat, 
           y = Stress_Levels, 
           fill = AgeCat)) +
  stat_halfeye(adjust = 0.5,
               justification = -0.2,
               .width = 0,
               point_colour = NA) +
  geom_boxplot(width = .20,
               outlier.shape = NA) +
  facet_wrap(~ Region) +
  geom_text(data = summary_stats, 
            aes(x = AgeCat, 
                y = Q25 - 2,  # Place 25th percentile lower
                label = paste("25th: ", round(Q25, 1))), 
            size = 3, color = "black", vjust = -4.5) +  
  geom_text(data = summary_stats, 
            aes(x = AgeCat, 
                y = median_BP,  # Place median in the middle
                label = paste("Median: ", round(median_BP, 1))), 
            size = 3, color = "black", vjust = -0.3) +  
  geom_text(data = summary_stats, 
            aes(x = AgeCat, 
                y = Q75 + 2,  # Place 75th percentile higher
                label = paste("75th: ", round(Q75, 1))), 
            size = 3, color = "black", vjust = 5) +  
  labs(title = "Region vs Stress by Gender", 
       x = "Region", 
       y = "Stress") +
  scale_fill_manual(values = c("Young" = "#ffde59", "Middle-Aged" = "#e79251", "Old" = "#9cc567")) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        legend.position = "none")

# Normalize the proportion of heart attack cases by Gender and Region
normalized_proportion_heartattack_group <- yesheartattack %>%
  group_by(Gender, Region) %>%
  summarise(HeartAttackCases = n(), .groups = "drop") %>%
  group_by(Region) %>%
  mutate(TotalHeartAttackCasesRegion = sum(HeartAttackCases)) %>%
  ungroup() %>%
  mutate(NormalizedProportion = HeartAttackCases / TotalHeartAttackCasesRegion * 100)

# Create the bar plot with normalized proportions
gender_reg <- ggplot(normalized_proportion_heartattack_group, aes(x = interaction(Gender, Region), y = NormalizedProportion, fill = interaction(Gender, Region))) +
  geom_bar(stat = "identity", show.legend = FALSE, color = "black") +
  geom_text(aes(label = sprintf("%.1f%%", NormalizedProportion)), vjust = 0.6, size = 3, hjust = 1.3) +
  labs(x = "Gender-Region Group", y = "Proportion of Heart Attack Cases (%)") +
  scale_fill_manual(values = c("Male.Urban" = "#0d8ab7", "Female.Urban" = "#e78090", "Male.Rural" = "#83bace", "Female.Rural" = "#f0c6c7")) +
  theme_minimal() +
  theme(axis.title.x= element_text(size=8),axis.title.y = element_blank(), plot.title = element_blank()) +
  coord_flip()


halfeyereg / gender_reg + plot_layout(heights = c(1.5, 0.5))

```
:::

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

-   Stress levels increase slightly with age for both genders, with older men experiencing higher overall stress than women. Overall, male heart attack patients tend to have slightly higher stress levels, whereas female heart attack patients experience lower stress compared to their non-heart attack counterparts.

-   Urban individuals report slightly higher stress than rural individuals, but rural males have the highest proportion of heart attack cases (52.3%). Despite higher stress in urban areas, heart attack rates remain lower.
:::

### 5.3.5 Diabetes History in Heart Attack Patients

Diabetes is a significant risk factor for cardiovascular disease, with individuals suffering from diabetes often exhibiting higher rates of heart disease and stroke. The relationship between diabetes and heart health is complex, as diabetes can accelerate the process of fatty plaques buildup in the arteries, which increases the likelihood of heart attacks and other cardiovascular events (Mattheus et al., 2013).

Understanding the influence of a history of diabetes on cardiovascular health is crucial for identifying high-risk populations. Specifically, individuals with a history of diabetes are more likely to experience complications related to blood pressure and cholesterol levels, both of which are critical indicators of heart health.

In this section, we will visualize the distribution of stress levels between individuals with and without a diabetes history. Using `geom_boxplot()` from the **ggplot2** package, we will plot the stress levels, grouped by diabetes history and age category. This will help us identify any significant differences in stress levels between the groups, allowing for a clearer understanding of how diabetes history and age may influence stress.

::: panel-tabset
## The Plot

```{r}
#| echo: False
# Calculate proportions of age categories within Diabetes History
heartattack_diabetes<- yesheartattack %>% 
  group_by(Diabetes_History, AgeCat) %>%
  summarise(Count = n(), .groups = "drop") %>%
  group_by(Diabetes_History) %>%
  mutate(Proportion = (Count / sum(Count)) * 100) 

# Diabetes Age Group Barchart
diabetesbar <- ggplot(heartattack_diabetes, aes(x = Diabetes_History, y = Proportion, fill = factor(AgeCat))) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) + 
  geom_text(aes(label = sprintf("%.1f%%", Proportion)), 
            position = position_dodge(width = 0.8), vjust = 0.2,hjust=1.2, size = 3) +  
  labs(
    title = "Diabetes History by Age Group and Stress Level",
    x = "Diabetes History",
    y = "Proportion (%)",
    fill = "Age Category"
  ) +
  scale_fill_manual(values = c("Young" = "#ffde59", "Middle-Aged" = "#e79251", "Old" = "#9cc567")) +
  theme_minimal()+
  theme(axis.title.x = element_blank())+
  coord_flip()


# Calculate the percentiles (25th, 50th, and 75th) for Stress Levels grouped by Diabetes History and AgeCat
age_dia_stress_data <- yesheartattack %>%
  group_by(Diabetes_History, AgeCat) %>%
  summarise(
    median_stress = median(Stress_Levels),
    q25_stress = quantile(Stress_Levels, 0.25),
    q75_stress = quantile(Stress_Levels, 0.75),
    .groups = "drop"
  )

# Boxplot for Age-Dia-Stress
age_dia_stress <- ggplot(yesheartattack, aes(x = Diabetes_History, y = Stress_Levels, fill = Diabetes_History)) +
  geom_boxplot() +
  facet_wrap(~ AgeCat) +
  labs(
       x = "Diabetes History",
       y = "Stress Levels") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title= element_blank()) +
  scale_fill_manual(values = c("Yes" = "#83bace", "No" = "#e78090")) +
  geom_text(data = age_dia_stress_data, aes(x = Diabetes_History, y = median_stress, label = paste("Median:", round(median_stress, 2))),
            position = position_nudge(y = 0.5), size = 3, color = "black") +
  geom_text(data = age_dia_stress_data, aes(x = Diabetes_History, y = q25_stress, label = paste("25th:", round(q25_stress, 2))),
            position = position_nudge(y = -0.5), size = 3, color = "black") +
  geom_text(data = age_dia_stress_data, aes(x = Diabetes_History, y = q75_stress, label = paste("75th:", round(q75_stress, 2))),
            position = position_nudge(y = 0.5), size = 3, color = "black")


diabetesbar/age_dia_stress +
  plot_layout(widths = c(1,2),heights = c(1,2))
```

## The Code

```{r}
#| eval: False
# Calculate proportions of age categories within Diabetes History
heartattack_diabetes<- yesheartattack %>% 
  group_by(Diabetes_History, AgeCat) %>%
  summarise(Count = n(), .groups = "drop") %>%
  group_by(Diabetes_History) %>%
  mutate(Proportion = (Count / sum(Count)) * 100) 

# Diabetes Age Group Barchart
diabetesbar <- ggplot(heartattack_diabetes, aes(x = Diabetes_History, y = Proportion, fill = factor(AgeCat))) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) + 
  geom_text(aes(label = sprintf("%.1f%%", Proportion)), 
            position = position_dodge(width = 0.8), vjust = 0.2,hjust=1.2, size = 3) +  
  labs(
    title = "Diabetes History by Age Group and Stress Level",
    x = "Diabetes History",
    y = "Proportion (%)",
    fill = "Age Category"
  ) +
  scale_fill_manual(values = c("Young" = "#ffde59", "Middle-Aged" = "#e79251", "Old" = "#9cc567")) +
  theme_minimal()+
  theme(axis.title.x = element_blank())+
  coord_flip()


# Calculate the percentiles (25th, 50th, and 75th) for Stress Levels grouped by Diabetes History and AgeCat
age_dia_stress_data <- yesheartattack %>%
  group_by(Diabetes_History, AgeCat) %>%
  summarise(
    median_stress = median(Stress_Levels),
    q25_stress = quantile(Stress_Levels, 0.25),
    q75_stress = quantile(Stress_Levels, 0.75),
    .groups = "drop"
  )

# Boxplot for Age-Dia-Stress
age_dia_stress <- ggplot(yesheartattack, aes(x = Diabetes_History, y = Stress_Levels, fill = Diabetes_History)) +
  geom_boxplot() +
  facet_wrap(~ AgeCat) +
  labs(
       x = "Diabetes History",
       y = "Stress Levels") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title= element_blank()) +
  scale_fill_manual(values = c("Yes" = "#83bace", "No" = "#e78090")) +
  geom_text(data = age_dia_stress_data, aes(x = Diabetes_History, y = median_stress, label = paste("Median:", round(median_stress, 2))),
            position = position_nudge(y = 0.5), size = 3, color = "black") +
  geom_text(data = age_dia_stress_data, aes(x = Diabetes_History, y = q25_stress, label = paste("25th:", round(q25_stress, 2))),
            position = position_nudge(y = -0.5), size = 3, color = "black") +
  geom_text(data = age_dia_stress_data, aes(x = Diabetes_History, y = q75_stress, label = paste("75th:", round(q75_stress, 2))),
            position = position_nudge(y = 0.5), size = 3, color = "black")


diabetesbar/age_dia_stress +
  plot_layout(widths = c(1,2),heights = c(1,2))
```
:::

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

-   The young age category represents the highest proportion among diabetic heart attack patients, accounting for 39.7% of the total. In contrast, the old age category has the lowest proportion. This trend suggests that younger individuals with diabetes may be more susceptible to heart attacks, possibly due to factors such as early onset of diabetes or other underlying risk factors.

-   For patients with no diabetes history, the young age category still has the highest proportion, but it is lower compared to the diabetic heart attack patients. This could be explained by the overall higher proportion of younger individuals in heart attack patients in general.

-   Interestingly, the middle-aged and old age categories show a higher proportion in non-diabetic heart attack patients compared to diabetic heart attack patients.

-   For old diabetic patients, stress levels appear to be significantly higher compared to other groups. However, diabetes history seems to have a notable impact only in the young age category. Specifically, young diabetic patients show higher stress levels than their non-diabetic counterparts. In contrast, for both the middle-aged and old groups, this relationship is reversed: older diabetic patients tend to have lower stress levels than their non-diabetic counterparts.
:::

------------------------------------------------------------------------

# 6 Clinical Implications from Visual Plots

The analysis of heart attack vulnerability across age, stress levels, and physiological factors provides critical insights for clinical practice. The following are key findings from this study:

1.  **Age-Specific Vulnerability**: Middle-aged males and older females exhibit higher susceptibility to heart attacks. Understanding these trends can help target early prevention strategies tailored to these demographics.

2.  **Role of Stress in Heart Attack Risk**:

    -   Older individuals tend to experience higher stress levels, with a significant impact on heart attack occurrence.

    -   Younger individuals with high stress exhibit lower diastolic blood pressure, suggesting potential adaptability, whereas older individuals experience increased diastolic BP under stress, indicating heightened risk.

3.  **Blood Pressure Variations**:

    -   Among heart attack cases, diastolic blood pressure demonstrates a stronger correlation with stress than systolic blood pressure.

    -   Older individuals show a direct relationship between stress and diastolic BP, reinforcing the role of chronic stress in heart attack risk.

4.  **Gender and Regional Disparities**:

    -   Stress levels rise with age for both genders, with older men experiencing higher stress levels.

    -   Urban populations report slightly higher stress levels than rural populations, yet rural males have the highest proportion of heart attack cases, likely due to healthcare access disparities and physically demanding labor.

5.  **Diabetes History**:

    -   Younger individuals with diabetes may be more vulnerable to heart attacks, possibly due to factors such as early onset of diabetes or other underlying risk factors.

    -   The effect of diabetes on stress is more pronounced in younger individuals, potentially due to the challenges of managing diabetes at an earlier age. In older individuals, other factors might outweigh the impact of diabetes on stress, or they may have developed coping mechanisms over time, leading to lower stress levels despite having diabetes.

These insights suggest that personalized interventions—ranging from stress management programs for younger individuals to targeted cardiovascular monitoring for older individuals—are essential for reducing heart attack risks across different population groups in Japan. Additionally, addressing regional disparities through improved healthcare accessibility in rural areas is crucial.

------------------------------------------------------------------------

# 7 Multiple Logistic Regression Model

Next, we will build a **logistic regression model** to confirm and further investigate the clinical implications suggested by the visual plots. Logistic regression is a statistical method used for modeling the relationship between a binary outcome variable and one or more predictor variables, as in our case, where we are predicting the likelihood of a heart attack (Yes/No).

## 7.1 Recoding Variables

### 7.1.1 Recoding Continuous Variables

To ensure that all continuous variables are on comparable scales and to avoid any one variable disproportionately influencing the model, we will scale these continuous variables between 0 and 1. This is especially important when the variables are on vastly different scales (for example, BMI vs. Heart Rate), as it ensures that the model treats them equally, improving the interpretability and stability of the regression results.

By scaling variables, each predictor has the same weight in the logistic regression model, preventing the model from being biased towards variables with larger numerical ranges. We will use the following code to create a new dataframe for the logistic regression with the name, *heartattack_lr*.

```{r}
heartattack_lr <- heartattack %>%
  mutate(
    Cholesterol_Level = rescale(Cholesterol_Level, to = c(0, 1)),
    BMI = rescale(BMI, to = c(0, 1)),
    Heart_Rate = rescale(Heart_Rate, to = c(0, 1)),
    Systolic_BP = rescale(Systolic_BP, to = c(0, 1)),
    Diastolic_BP = rescale(Diastolic_BP, to = c(0, 1))
  )
```

### 7.1.2 Recoding Categorical Variables

Logistic regression requires numerical input, so categorical variables—such as gender, region, and family history—must be converted into numerical values.

Categorical variables are either binary or multilevel for our dataset. For binary variables (such as Gender, Smoking History, and Hypertension History), we will recode the categories into two values: 0 and 1, where 0 typically represents the absence of the condition and 1 represents the presence.

For variables with more than two levels (such as Physical Activity, Region, and Diet Quality), we will assign each level a unique integer. These variables will be recoded into 0, 1, or 2 values, where each number represents a distinct category, allowing the logistic regression model to treat the categories appropriately without losing the ordinal information.

The following table shows how the categorical variables will be recoded.

| Binary (Recoded to 0 and 1)  | 3 Levels (Recoded to 0,1,2)            |
|------------------------------|----------------------------------------|
| Gender: Female/Male          | Physical_Activity: Low/Moderate/High   |
| Region: Urban/Rural          | Diet_Quality: Poor/Average/Good        |
| Smoking_History: Yes/No      | Alcohol_Consumption: Low/Moderate/High |
| Diabetes_History: Yes/No     | AgeCat: Young/Middle-Aged/Old          |
| Hypertension_History: Yes/No |                                        |
| Family_History: Yes/No       |                                        |

```{r}
heartattack_lr <- heartattack_lr %>%
  mutate(
    # Binary variables: 0 = No, 1 = Yes
    Gender = ifelse(Gender == "Female", 0, 1),  
    Region = ifelse(Region == "Urban", 0, 1),  
    Smoking_History = ifelse(Smoking_History == "No", 0, 1),  
    Diabetes_History = ifelse(Diabetes_History == "No", 0, 1),  
    Hypertension_History = ifelse(Hypertension_History == "No", 0, 1), 
    Family_History = ifelse(Family_History == "No", 0, 1),  
    
    # Three-level variables: 0 = Low/Poor/Young, 1 = Moderate/Average/Middle-Aged, 2 = High/Good/Old
    Physical_Activity = recode(Physical_Activity, "Low" = 0, "Moderate" = 1, "High" = 2),
    Diet_Quality = recode(Diet_Quality, "Poor" = 0, "Average" = 1, "Good" = 2),
    Alcohol_Consumption = recode(Alcohol_Consumption, "Low" = 0, "Moderate" = 1, "High" = 2),
    AgeCat = recode(AgeCat, "Young" = 0, "Middle-Aged" = 1, "Old" = 2),
    Stress = recode(Stress, "Low" = 0, "Medium" = 1, "High" = 2)
  )

```

### 7.1.3 Recoding Dependent Variable

We also recode the dependent variable for logistic regression.

The original dependent variable, `Heart_Attack_Occurrence` has responses such as "Yes" and "No." For logistic regression, we need to convert this categorical variable into numeric values. We will recode the variable as follows:

-   1: Indicates the occurrence of a heart attack (Yes)

-   0: Indicates no occurrence of a heart attack (No)

```{r}
heartattack_lr <- heartattack_lr %>%
  mutate(Heart_Attack_Recode = ifelse(Heart_Attack_Occurrence == "Yes", 1, 0))
```

## 7.2 The Models

We are now ready for building **logistic regression models** specifically for the **young category** individuals. The goal is to evaluate how well various predictor variables influence the likelihood of a heart attack occurrence among younger individuals (defined in the dataset as those categorized as "Young").

To enhance our understanding, we will also build a logistic regression model for the **old category** for comparison. By comparing these models, we can examine whether different age groups exhibit distinct risk factors for heart attack occurrences. This comparison can provide valuable insights into whether certain predictors are more relevant for younger individuals or if they affect all age groups similarly.

### 7.2.1 Logistic Regression Model for Young Category

We first build a base logistic regression model as the initial model that includes all predictor variables without any further optimization.

Then we refine the model using the **forward stepwise regression** method to systematically add predictors one by one, based on their statistical significance. This approach allows us to identify the most relevant variables while removing those that do not contribute significantly to the model's predictive power.

```{r}
heartattack_young <- heartattack_lr %>%
  filter(AgeCat == 0)
```

```{r}
heartattack_lr_young <- glm(Heart_Attack_Recode ~ 
                              Gender + 
                              Region + 
                              Smoking_History + 
                              Diabetes_History + 
                              Hypertension_History + 
                              Family_History + 
                              Physical_Activity + 
                              Diet_Quality + 
                              Alcohol_Consumption + 
                              Cholesterol_Level+
                              Stress+
                              BMI+
                              Systolic_BP+
                              Diastolic_BP+
                              Heart_Rate, 
                            data = heartattack_young, 
                            family = binomial())

heartattack_lr_young_step <- step(heartattack_lr_young, 
                                       direction = "forward", 
                                       trace = FALSE)
summary(heartattack_lr_young_step)
```

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

-   **Diabetes history** is the most significant predictor in the model for younger individuals, indicating that having a history of diabetes increases the risk of a heart attack.

-   **Stress levels** is also significant for young individuals. However, it is a slight negative relationship with heart attack occurrence, meaning that higher stress levels may be associated with a lower likelihood of experiencing a heart attack in this age group, which could be due to the complexity of stress as a factor—possibly indicating that individuals with higher stress may be more likely to engage in behaviors or seek treatments that reduce heart attack risk.

-   All other predictors are insignificant.
:::

### 7.2.2 Logistic Regression Model for Old Category

Again, we do the same for the old category.

```{r}
heartattack_old <- heartattack_lr %>%
  filter(AgeCat == 2)
```

```{r}
heartattack_lr_old <- glm(Heart_Attack_Recode ~ 
                              Gender + 
                              Region + 
                              Smoking_History + 
                              Diabetes_History + 
                              Hypertension_History + 
                              Family_History + 
                              Physical_Activity + 
                              Diet_Quality + 
                              Alcohol_Consumption + 
                              Cholesterol_Level+
                              Stress+
                              BMI+
                              Systolic_BP+
                              Diastolic_BP+
                              Heart_Rate, 
                            data = heartattack_old, 
                            family = binomial())

heartattack_lr_old_step<- step(heartattack_lr_old, 
                                               direction = "forward", 
                                               trace = FALSE)
summary(heartattack_lr_old_step)
```

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

The logistic regression model for the old category indicates that only cholesterol level might have some marginal relevance,with a p value of 0.141, but overall, many of the variables do not show a significant impact.
:::

## 7.3 Comparison of Models

::: panel-tabset
## Young

```{r}
tbl_regression(heartattack_lr_young_step,
               intercept = TRUE,
               estimate_fun = purrr::partial(style_sigfig, digits = 4)) %>%
  add_glance_source_note(
    include = c(AIC, BIC, deviance, df.residual))
```

## Old

```{r}
tbl_regression(heartattack_lr_old_step,
               intercept = TRUE,
               estimate_fun = purrr::partial(style_sigfig, digits = 4)) %>%
  add_glance_source_note(
    include = c(AIC, BIC, deviance, df.residual))
```
:::

::: {.callout-note style="color: black; background-color: #e0f3f9"}
## Insights

#### **1. Significance of Predictors:**

-   **Young Category**: Significant predictors such as Diabetes History (positive relationship with heart attack risk) and Stress Levels (negative relationship with heart attack risk) suggest that lifestyle and health conditions like diabetes, alongside stress, play an important role in the likelihood of heart attacks in the young.

-   **Old Category**: There are no significant predictors in the old category.The lack of significant results may be due to the age group having a more homogeneous risk factor profile, with factors such as age playing a dominant role in heart attack occurrence.

#### 2. **Model Fit:**

-   **Young Category**: The model for the young category has a residual deviance of 6077 and an AIC of 6109.6, indicating that the model fits the data moderately well. The significance of a few variables suggests that the model explains some variation in heart attack occurrence.

-   **Old Category**: The residual deviance for the old category is 5625, and the AIC is 5658, which also indicates a reasonable model fit, although no variables were found to be statistically significant.
:::

------------------------------------------------------------------------

# 8 Summary

This study examines the relationship between stress, age, gender, and heart attack occurrence. While stress levels show a statistically significant difference between individuals with and without a heart attack, the clinical relevance remains minimal. Older patients exhibit higher stress levels and greater variability in diastolic blood pressure (DBP), suggesting potential stress-induced hypertension. In contrast, younger individuals show better cardiovascular adaptability, with lower systolic and diastolic blood pressure under stress.

Gender and geographic location also influence heart attack risk, with males and rural populations being more vulnerable. These findings emphasize the importance of considering age, stress, and access to healthcare in heart attack prevention and management.

The logistic regression results support these insights, highlighting that stress levels are marginally significant for young individuals, aligning with the earlier observation that stress plays a crucial role in heart attack risk. Additionally, diabetes history emerged as a significant predictor for younger individuals, reinforcing that health conditions like diabetes are important in determining heart attack vulnerability. For the older group, the lack of significant predictors contrasts with the earlier insight about stress's impact, possibly reflecting the complexity of risk factors in older populations that are not fully captured by the model.

------------------------------------------------------------------------

# References

Cohen, S. (1994). *Perceived Stress Scale*. Mind Garden. Retrieved from <https://www.mindgarden.com/documents/PerceivedStressScale.pdf>

Gordon, A.M. & Mendes, W.B. (2021). A large-scale study of stress, emotions, and blood pressure in daily life using a digital platform, Proc. Natl. Acad. Sci. U.S.A. 118 (31) e2105573118, <https://doi.org/10.1073/pnas.2105573118>

Iso H. (2011). Lifestyle and cardiovascular disease in Japan. *Journal of atherosclerosis and thrombosis*, *18*(2), 83–88. https://doi.org/10.5551/jat.6866

Jung, E., Kong, S. Y., Ro, Y. S., Ryu, H. H., & Shin, S. D. (2022). Serum Cholesterol Levels and Risk of Cardiovascular Death: A Systematic Review and a Dose-Response Meta-Analysis of Prospective Cohort Studies. *International journal of environmental research and public health*, *19*(14), 8272. https://doi.org/10.3390/ijerph19148272

Lauer, M. S., Okin, P. M., Larson, M. G., Evans, J. C., Levy, D. (2004). Impaired heart rate response to graded exercise: Prognostic implications of chronotropic incompetence in the Framingham Heart Study. *Circulation, 109*(7), 988–994. [https://doi.org/10.1161/01.CIR.0000141564.89465.4E](https://www.ahajournals.org/doi/10.1161/01.CIR.0000141564.89465.4E)

Matheus, A. S., Tannus, L. R., Cobas, R. A., Palma, C. C., Negrato, C. A., & Gomes, M. B. (2013). Impact of diabetes on cardiovascular disease: an update. *International journal of hypertension*, *2013*, 653789. https://doi.org/10.1155/2013/653789
